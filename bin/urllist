#!/bin/sh

# urllist read stdin, looks for url, lists them and asks the user to choose one to open in firefox
# it was made to work with mails especially

# we clear the terminal to avoid exposing noise
clear

urls="$(sed 's/=$//' < /dev/stdin | tr -d '\n' | grep -Pow "https?://[^\\s\"\\'<>\\]\\[\\{\\}]+")"
n=0
printf "%s" "$urls" | while read -r URL; do
    n=$(( n + 1 ))
    printf "%s\\t%s\\n" "$n" "$URL"
done

printf "\\nWhich url would you like to open ? "
read -r number < /dev/tty

number=$(printf "%s" "$number" | sed -E 's/[^0-9]+//g')

if [ -z "$number" ] || [ "$number" -lt 1 ] || [ "$number" -gt "$(( $(printf "%s" "$urls" | wc -l) + 1))" ]; then
    printf "Invalid number. Aborting. \\n"
    exit 1
fi

url="$(printf "%s" "$urls" | sed "${number}q;d")"
firefox "$url"
