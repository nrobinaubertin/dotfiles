#!/bin/sh

# prepare a target to be read by mpv
read_target() {
  if [ -e "$1" ]; then
    if [ -d "$1" ] && [ -f "$1/index.m3u" ]; then
      to_play="$1/index.m3u"
    else
      to_play="$1"
    fi
  else
    if echo "$1" | grep "^http" >/dev/null; then
      to_play="$1"
    fi
  fi
  echo "$to_play"
}

tracks=""
options=""
for term in "$@"; do
  case "$term" in
    "--loop") options="$options --loop-playlist";;
    *)
      if [ "$tracks" = "" ]; then
        tracks="$(read_target "$term")"
      else
          tracks="$tracks\n$(read_target "$term")"
      fi;;
  esac
done

echo "$tracks" | mpv --no-video --playlist=- "$options"
